Current Mongosh Log ID:	6458e197db9f4016edf6ceca
Connecting to:		mongodb://127.0.0.1:27017/?directConnection=true&serverSelectionTimeoutMS=2000&appName=mongosh+1.8.0
Using MongoDB:		6.0.5
Using Mongosh:		1.8.0

For mongosh info see: https://docs.mongodb.com/mongodb-shell/

------
   The server generated these startup warnings when booting
   2023-05-08T11:46:51.911+00:00: Using the XFS filesystem is strongly recommended with the WiredTiger storage engine. See http://dochub.mongodb.org/core/prodnotes-filesystem
   2023-05-08T11:46:52.499+00:00: Access control is not enabled for the database. Read and write access to data and configuration is unrestricted
   2023-05-08T11:46:52.499+00:00: /sys/kernel/mm/transparent_hugepage/enabled is 'always'. We suggest setting it to 'never'
   2023-05-08T11:46:52.499+00:00: vm.max_map_count is too low
------

------
   Enable MongoDB's free cloud-based monitoring service, which will then receive and display
   metrics about your deployment (disk utilization, CPU, operation statistics, etc).
   
   The monitoring data will be available on a MongoDB website with a unique URL accessible to you
   and anyone you share the URL with. MongoDB may use this information to make product
   improvements and to suggest MongoDB products and deployment options to you.
   
   To enable free monitoring, run the following command: db.enableFreeMonitoring()
   To permanently disable this reminder, run the following command: db.disableFreeMonitoring()
------

Loading file: home/5_userMessages.js
{
  explainVersion: '1',
  stages: [
    {
      '$cursor': {
        queryPlanner: {
          namespace: 'FriendWorker.users',
          indexFilterSet: false,
          parsedQuery: {},
          queryHash: 'F1314F6A',
          planCacheKey: 'F1314F6A',
          maxIndexedOrSolutionsReached: false,
          maxIndexedAndSolutionsReached: false,
          maxScansToExplodeReached: false,
          winningPlan: {
            stage: 'PROJECTION_SIMPLE',
            transformBy: {
              _id: 1,
              address: 1,
              dateOfBirth: 1,
              email: 1,
              firstName: 1,
              friends: 1,
              lastName: 1,
              messages: 1
            },
            inputStage: {
              stage: 'COLLSCAN',
              direction: 'forward'
            }
          },
          rejectedPlans: []
        },
        executionStats: {
          executionSuccess: true,
          nReturned: 1000,
          executionTimeMillis: 767,
          totalKeysExamined: 0,
          totalDocsExamined: 1000,
          executionStages: {
            stage: 'PROJECTION_SIMPLE',
            nReturned: 1000,
            executionTimeMillisEstimate: 0,
            works: 1002,
            advanced: 1000,
            needTime: 1,
            needYield: 0,
            saveState: 2,
            restoreState: 2,
            isEOF: 1,
            transformBy: {
              _id: 1,
              address: 1,
              dateOfBirth: 1,
              email: 1,
              firstName: 1,
              friends: 1,
              lastName: 1,
              messages: 1
            },
            inputStage: {
              stage: 'COLLSCAN',
              nReturned: 1000,
              executionTimeMillisEstimate: 0,
              works: 1002,
              advanced: 1000,
              needTime: 1,
              needYield: 0,
              saveState: 2,
              restoreState: 2,
              isEOF: 1,
              direction: 'forward',
              docsExamined: 1000
            }
          },
          allPlansExecution: []
        }
      },
      nReturned: Long("1000"),
      executionTimeMillisEstimate: Long("2")
    },
    {
      '$lookup': {
        from: 'messages',
        as: 'messages',
        let: {
          user_id: '$_id'
        },
        pipeline: [
          {
            '$match': {
              '$expr': {
                '$and': [
                  {
                    '$or': [
                      {
                        '$eq': [
                          '$author',
                          '$$user_id'
                        ]
                      },
                      {
                        '$eq': [
                          '$receiver',
                          '$$user_id'
                        ]
                      }
                    ]
                  }
                ]
              }
            }
          }
        ]
      },
      totalDocsExamined: Long("337000"),
      totalKeysExamined: Long("0"),
      collectionScans: Long("2000"),
      indexesUsed: [],
      nReturned: Long("1000"),
      executionTimeMillisEstimate: Long("753")
    },
    {
      '$project': {
        _id: true,
        firstName: true,
        dateOfBirth: true,
        friends: true,
        lastName: true,
        email: true,
        address: true,
        sent_messages_count: {
          '$size': [
            {
              '$filter': {
                input: '$messages',
                as: 'this',
                cond: {
                  '$eq': [
                    '$$this.author',
                    '$_id'
                  ]
                }
              }
            }
          ]
        },
        received_messages_count: {
          '$size': [
            {
              '$filter': {
                input: '$messages',
                as: 'this',
                cond: {
                  '$eq': [
                    '$$this.receiver',
                    '$_id'
                  ]
                }
              }
            }
          ]
        }
      },
      nReturned: Long("1000"),
      executionTimeMillisEstimate: Long("757")
    }
  ],
  serverInfo: {
    host: '5840582b630e',
    port: 27017,
    version: '6.0.5',
    gitVersion: 'c9a99c120371d4d4c52cbb15dac34a36ce8d3b1d'
  },
  serverParameters: {
    internalQueryFacetBufferSizeBytes: 104857600,
    internalQueryFacetMaxOutputDocSizeBytes: 104857600,
    internalLookupStageIntermediateDocumentMaxSizeBytes: 104857600,
    internalDocumentSourceGroupMaxMemoryBytes: 104857600,
    internalQueryMaxBlockingSortMemoryUsageBytes: 104857600,
    internalQueryProhibitBlockingMergeOnMongoS: 0,
    internalQueryMaxAddToSetBytes: 104857600,
    internalDocumentSourceSetWindowFieldsMaxMemoryBytes: 104857600
  },
  command: {
    aggregate: 'users',
    pipeline: [
      {
        '$lookup': {
          from: 'messages',
          let: {
            user_id: '$_id'
          },
          pipeline: [
            {
              '$match': {
                '$expr': {
                  '$and': [
                    {
                      '$or': [
                        {
                          '$eq': [
                            '$author',
                            '$$user_id'
                          ]
                        },
                        {
                          '$eq': [
                            '$receiver',
                            '$$user_id'
                          ]
                        }
                      ]
                    }
                  ]
                }
              }
            }
          ],
          as: 'messages'
        }
      },
      {
        '$project': {
          firstName: 1,
          lastName: 1,
          email: 1,
          address: 1,
          dateOfBirth: 1,
          friends: 1,
          sent_messages_count: {
            '$size': {
              '$filter': {
                input: '$messages',
                cond: {
                  '$eq': [
                    '$$this.author',
                    '$_id'
                  ]
                }
              }
            }
          },
          received_messages_count: {
            '$size': {
              '$filter': {
                input: '$messages',
                cond: {
                  '$eq': [
                    '$$this.receiver',
                    '$_id'
                  ]
                }
              }
            }
          }
        }
      }
    ],
    cursor: {},
    '$db': 'FriendWorker'
  },
  ok: 1,
  '$clusterTime': {
    clusterTime: Timestamp({ t: 1683546520, i: 2 }),
    signature: {
      hash: Binary(Buffer.from("0000000000000000000000000000000000000000", "hex"), 0),
      keyId: Long("0")
    }
  },
  operationTime: Timestamp({ t: 1683546520, i: 2 })
}
[
  {
    _id: 'user_1',
    firstName: 'Rickert',
    lastName: 'Reolfo',
    email: 'rreolfo0@sciencedaily.com',
    dateOfBirth: ISODate("2007-07-31T13:06:00.000Z"),
    address: {
      city: 'Cagnes-sur-Mer',
      postal: '629 392',
      street: '311 American Alley',
      country: 'France'
    },
    sent_messages_count: 0,
    received_messages_count: 1
  },
  {
    _id: 'user_8',
    firstName: 'Honey',
    lastName: 'Varnam',
    email: 'hvarnam7@kickstarter.com',
    dateOfBirth: ISODate("2003-10-15T12:37:10.000Z"),
    address: {
      city: 'Fengchan',
      postal: '323 147',
      street: '2990 Colorado Place',
      country: 'China'
    },
    sent_messages_count: 0,
    received_messages_count: 1
  },
  {
    _id: 'user_9',
    firstName: 'Raquela',
    lastName: 'Jerg',
    email: 'rjerg8@aol.com',
    dateOfBirth: ISODate("2018-07-31T13:27:18.000Z"),
    address: {
      city: 'Palagao Norte',
      postal: '020 884',
      street: '90 Chive Court',
      country: 'Philippines'
    },
    sent_messages_count: 0,
    received_messages_count: 0
  },
  {
    _id: 'user_10',
    firstName: 'Georges',
    lastName: 'Giannotti',
    email: 'ggiannotti9@businessweek.com',
    dateOfBirth: ISODate("2013-06-08T00:48:00.000Z"),
    address: {
      city: 'VĂ¤sterhaninge',
      postal: '798 285',
      street: '815 Westport Terrace',
      country: 'Sweden'
    },
    sent_messages_count: 0,
    received_messages_count: 0
  },
  {
    _id: 'user_4',
    firstName: 'Rosabel',
    lastName: 'Higounet',
    email: 'rhigounet3@netvibes.com',
    dateOfBirth: ISODate("2020-08-23T03:18:16.000Z"),
    address: {
      city: 'Toyohashi',
      postal: '253 524',
      street: '90862 Warner Road',
      country: 'Japan'
    },
    sent_messages_count: 0,
    received_messages_count: 0
  },
  {
    _id: 'user_11',
    firstName: 'Rebecca',
    lastName: 'Paylie',
    email: 'rpayliea@google.com.hk',
    dateOfBirth: ISODate("2000-09-28T08:03:32.000Z"),
    address: {
      city: 'Azaruja',
      postal: '756 771',
      street: '82731 Buhler Drive',
      country: 'Portugal'
    },
    sent_messages_count: 0,
    received_messages_count: 1
  },
  {
    _id: 'user_12',
    firstName: 'Israel',
    lastName: 'Kyncl',
    email: 'ikynclb@flavors.me',
    dateOfBirth: ISODate("2005-01-27T01:03:35.000Z"),
    address: {
      city: 'Char BhadrÄ\x81san',
      postal: '484 277',
      street: '14526 Goodland Terrace',
      country: 'Bangladesh'
    },
    sent_messages_count: 0,
    received_messages_count: 0
  },
  {
    _id: 'user_13',
    firstName: 'Emlen',
    lastName: 'Haughey',
    email: 'ehaugheyc@wikia.com',
    dateOfBirth: ISODate("2000-05-23T10:11:35.000Z"),
    address: {
      city: 'Obernai',
      postal: '168 490',
      street: '9773 Russell Place',
      country: 'France'
    },
    sent_messages_count: 0,
    received_messages_count: 0
  },
  {
    _id: 'user_14',
    firstName: 'Mirabelle',
    lastName: 'Darling',
    email: 'mdarlingd@creativecommons.org',
    dateOfBirth: ISODate("2004-01-16T00:37:00.000Z"),
    address: {
      city: 'Novotroitsk',
      postal: '600 858',
      street: '03420 Walton Hill',
      country: 'Russia'
    },
    sent_messages_count: 0,
    received_messages_count: 0
  },
  {
    _id: 'user_15',
    firstName: 'Elvin',
    lastName: 'Bradane',
    email: 'ebradanee@nhs.uk',
    dateOfBirth: ISODate("1999-07-22T09:42:25.000Z"),
    address: {
      city: 'Changle',
      postal: '890 964',
      street: '32128 Fieldstone Drive',
      country: 'China'
    },
    sent_messages_count: 0,
    received_messages_count: 0
  },
  {
    _id: 'user_16',
    firstName: 'Aubry',
    lastName: 'Overton',
    email: 'aovertonf@loc.gov',
    dateOfBirth: ISODate("2015-06-27T14:34:26.000Z"),
    address: {
      city: 'Cascavel',
      postal: '660 276',
      street: '805 Lakewood Gardens Place',
      country: 'Brazil'
    },
    sent_messages_count: 1,
    received_messages_count: 0
  },
  {
    _id: 'user_6',
    firstName: 'Johnnie',
    lastName: 'Hedges',
    email: 'jhedges5@hud.gov',
    dateOfBirth: ISODate("2015-12-22T13:51:29.000Z"),
    address: {
      city: 'Ĺ entrupert',
      postal: '980 235',
      street: '3 Warner Pass',
      country: 'Slovenia'
    },
    sent_messages_count: 0,
    received_messages_count: 0
  },
  {
    _id: 'user_17',
    firstName: 'Daphene',
    lastName: 'Worts',
    email: 'dwortsg@addtoany.com',
    dateOfBirth: ISODate("2003-06-25T21:58:35.000Z"),
    address: {
      city: 'Lakki Marwat',
      postal: '335 544',
      street: '42632 Harper Crossing',
      country: 'Pakistan'
    },
    sent_messages_count: 1,
    received_messages_count: 0
  },
  {
    _id: 'user_5',
    firstName: 'Tybi',
    lastName: 'Dafter',
    email: 'tdafter4@nationalgeographic.com',
    dateOfBirth: ISODate("2006-11-11T17:16:58.000Z"),
    address: {
      city: 'Dhidhdhoo',
      postal: '363 328',
      street: '7 Hintze Pass',
      country: 'Maldives'
    },
    sent_messages_count: 1,
    received_messages_count: 1
  },
  {
    _id: 'user_3',
    firstName: 'Miller',
    lastName: 'Weller',
    email: 'mweller2@purevolume.com',
    dateOfBirth: ISODate("2014-05-13T07:35:50.000Z"),
    address: {
      city: 'Doblas',
      postal: '971 904',
      street: '745 Bunker Hill Avenue',
      country: 'Argentina'
    },
    sent_messages_count: 0,
    received_messages_count: 0
  },
  {
    _id: 'user_23',
    firstName: 'Kassey',
    lastName: 'Shailer',
    email: 'kshailerm@scientificamerican.com',
    dateOfBirth: ISODate("2021-05-22T00:25:46.000Z"),
    address: {
      city: 'Ulaan-Ereg',
      postal: '323 021',
      street: '18022 Del Sol Way',
      country: 'Mongolia'
    },
    sent_messages_count: 0,
    received_messages_count: 1
  },
  {
    _id: 'user_22',
    firstName: 'Pammi',
    lastName: "Maggill'Andreis",
    email: 'pmaggillandreisl@wunderground.com',
    dateOfBirth: ISODate("2010-02-24T16:27:15.000Z"),
    address: {
      city: 'Mqabba',
      postal: '803 073',
      street: '12090 Burning Wood Plaza',
      country: 'Malta'
    },
    sent_messages_count: 0,
    received_messages_count: 0
  },
  {
    _id: 'user_2',
    firstName: 'Ray',
    lastName: 'Bunworth',
    email: 'rbunworth1@hao123.com',
    dateOfBirth: ISODate("2001-06-18T14:06:00.000Z"),
    address: {
      city: 'Jingtan',
      postal: '959 257',
      street: '6 Commercial Hill',
      country: 'China'
    },
    sent_messages_count: 1,
    received_messages_count: 1
  },
  {
    _id: 'user_24',
    firstName: 'Elmo',
    lastName: 'Fincke',
    email: 'efincken@icio.us',
    dateOfBirth: ISODate("2009-05-27T11:35:32.000Z"),
    address: {
      city: 'Gucheng',
      postal: '218 755',
      street: '4 Novick Court',
      country: 'China'
    },
    sent_messages_count: 0,
    received_messages_count: 0
  },
  {
    _id: 'user_25',
    firstName: 'Ddene',
    lastName: 'Curror',
    email: 'dcurroro@fastcompany.com',
    dateOfBirth: ISODate("2006-03-21T03:36:56.000Z"),
    address: {
      city: 'Porto Salvo',
      postal: '184 103',
      street: '57806 Porter Junction',
      country: 'Portugal'
    },
    sent_messages_count: 0,
    received_messages_count: 0
  }
]
Type "it" for more
